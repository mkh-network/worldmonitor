---
phase: 07-conservation-energy-trackers
plan: 03
type: execute
wave: 2
depends_on:
  - 07-01
  - 07-02
files_modified:
  - src/App.ts
  - src/config/variants/happy.ts
  - src/styles/happy-theme.css
autonomous: true
requirements:
  - SPECIES-01
  - SPECIES-02
  - SPECIES-03
  - ENERGY-01
  - ENERGY-02
  - ENERGY-03

must_haves:
  truths:
    - "Species comeback panel appears on the happy variant dashboard with conservation win cards"
    - "Renewable energy panel appears on the happy variant dashboard with animated gauge"
    - "Both panels load data on startup and refresh with the happy variant data pipeline"
    - "Both panels are properly destroyed on App shutdown"
    - "CSS styles render species cards and energy gauge attractively in both light and dark modes"
  artifacts:
    - path: "src/App.ts"
      provides: "Full lifecycle wiring for SpeciesComebackPanel and RenewableEnergyPanel"
      contains: "SpeciesComebackPanel"
    - path: "src/config/variants/happy.ts"
      provides: "Panel config entries for species and renewable panels"
      contains: "species"
    - path: "src/styles/happy-theme.css"
      provides: "CSS styles for species cards, sparklines, gauge, and regional breakdown"
      contains: "species-card"
  key_links:
    - from: "src/App.ts"
      to: "src/components/SpeciesComebackPanel.ts"
      via: "import and instantiate in createPanels()"
      pattern: "import.*SpeciesComebackPanel"
    - from: "src/App.ts"
      to: "src/components/RenewableEnergyPanel.ts"
      via: "import and instantiate in createPanels()"
      pattern: "import.*RenewableEnergyPanel"
    - from: "src/App.ts"
      to: "src/services/conservation-data.ts"
      via: "import fetchConservationWins for data loading"
      pattern: "import.*fetchConservationWins"
    - from: "src/App.ts"
      to: "src/services/renewable-energy-data.ts"
      via: "import fetchRenewableEnergyData for data loading"
      pattern: "import.*fetchRenewableEnergyData"
---

<objective>
Wire SpeciesComebackPanel and RenewableEnergyPanel into App.ts lifecycle, add panel config entries to happy.ts, and create CSS styles for species cards and energy gauge in happy-theme.css.

Purpose: Makes both Phase 7 panels visible and functional on the happy variant dashboard. Without this wiring plan, the panels exist as dead code.

Output: Updated App.ts, happy.ts config, and happy-theme.css
</objective>

<execution_context>
@/Users/sebastienmelki/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastienmelki/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-conservation-energy-trackers/07-01-SUMMARY.md
@.planning/phases/07-conservation-energy-trackers/07-02-SUMMARY.md
@.planning/phases/05-humanity-data-panels/05-03-SUMMARY.md — App.ts wiring pattern for happy variant panels
@.planning/phases/06-content-spotlight-panels/06-03-SUMMARY.md — Latest App.ts wiring pattern
@src/App.ts — Target for panel wiring (follow existing happy variant panel patterns)
@src/config/variants/happy.ts — Target for panel config entries
@src/styles/happy-theme.css — Target for CSS styles
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire both panels into App.ts lifecycle and update happy.ts config</name>
  <files>
    src/App.ts
    src/config/variants/happy.ts
  </files>
  <action>
**Update `src/App.ts`** — Follow the exact same pattern used for CountersPanel/ProgressChartsPanel (Phase 5) and Phase 6 panels. All changes gated by `SITE_VARIANT === 'happy'`.

1. **Add imports** (at top with other panel imports):
```typescript
import { SpeciesComebackPanel } from '@/components/SpeciesComebackPanel';
import { RenewableEnergyPanel } from '@/components/RenewableEnergyPanel';
import { fetchConservationWins } from '@/services/conservation-data';
import { fetchRenewableEnergyData } from '@/services/renewable-energy-data';
```

2. **Add class properties** (alongside existing happy panel properties like `countersPanel`, `progressPanel`, etc.):
```typescript
private speciesPanel: SpeciesComebackPanel | null = null;
private renewablePanel: RenewableEnergyPanel | null = null;
```

3. **Instantiate panels in `createPanels()`** (inside the existing `if (SITE_VARIANT === 'happy')` block, after other happy panel instantiations):
```typescript
this.speciesPanel = new SpeciesComebackPanel();
this.panels['species'] = this.speciesPanel;

this.renewablePanel = new RenewableEnergyPanel();
this.panels['renewable'] = this.renewablePanel;
```

4. **Add data loading tasks** — Find the location where happy variant data tasks are added (look for existing `runGuarded` calls for happy panels in `refreshAll()` or the initial data loading section). Add two new tasks:

```typescript
if (SITE_VARIANT === 'happy') {
  tasks.push({
    name: 'species',
    task: runGuarded('species', () => this.loadSpeciesData()),
  });
  tasks.push({
    name: 'renewable',
    task: runGuarded('renewable', () => this.loadRenewableData()),
  });
}
```

5. **Add private load methods** (alongside existing happy data loading methods like `loadProgressData`):

```typescript
private async loadSpeciesData(): Promise<void> {
  const species = await fetchConservationWins();
  this.speciesPanel?.setData(species);
}

private async loadRenewableData(): Promise<void> {
  const data = await fetchRenewableEnergyData();
  this.renewablePanel?.setData(data);
}
```

6. **Add destroy cleanup** (in `destroy()` method, before map cleanup, alongside existing happy panel destroy calls):
```typescript
this.speciesPanel?.destroy();
this.renewablePanel?.destroy();
```

**Update `src/config/variants/happy.ts`** — Add two new panel entries to `DEFAULT_PANELS`:

```typescript
species: { name: 'Conservation Wins', enabled: true, priority: 1 },
renewable: { name: 'Renewable Energy', enabled: true, priority: 1 },
```

Place these after the existing `digest` entry.
  </action>
  <verify>
Run `npx tsc --noEmit` — no type errors. Verify App.ts contains imports, class properties, createPanels() instantiation, data loading tasks, load methods, and destroy cleanup for both panels. Verify happy.ts has species and renewable entries.
  </verify>
  <done>
Both panels are wired into App.ts with full lifecycle: import, instantiate, data load, destroy. happy.ts config has species and renewable panel entries. TypeScript compiles cleanly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add CSS styles for species cards and renewable energy gauge</name>
  <files>src/styles/happy-theme.css</files>
  <action>
Add CSS styles to `src/styles/happy-theme.css` — append at the end of the file, following the established convention of `[data-variant='happy']` scoped selectors with compound `[data-variant='happy'][data-theme='dark']` for dark mode overrides.

**Species Card Styles:**

```css
/* === Species Comeback Panel === */

[data-variant='happy'] .species-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  padding: 12px;
}

@media (max-width: 768px) {
  [data-variant='happy'] .species-grid {
    grid-template-columns: 1fr;
  }
}

[data-variant='happy'] .species-card {
  background: var(--bg-secondary);
  border-radius: var(--panel-radius, 14px);
  overflow: hidden;
  border: 1px solid var(--border);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

[data-variant='happy'] .species-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

[data-variant='happy'] .species-photo {
  width: 100%;
  height: 120px;
  overflow: hidden;
}

[data-variant='happy'] .species-photo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

[data-variant='happy'] .species-info {
  padding: 8px 12px 4px;
}

[data-variant='happy'] .species-name {
  font-size: 14px;
  font-weight: 700;
  color: var(--text);
  margin: 0 0 2px;
}

[data-variant='happy'] .species-scientific {
  font-size: 11px;
  font-style: italic;
  color: var(--text-dim);
  display: block;
  margin-bottom: 6px;
}

[data-variant='happy'] .species-badges {
  display: flex;
  gap: 6px;
  margin-bottom: 6px;
}

[data-variant='happy'] .species-badge {
  font-size: 10px;
  font-weight: 600;
  padding: 2px 8px;
  border-radius: 10px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

[data-variant='happy'] .badge-recovered {
  background: rgba(107, 143, 94, 0.15);
  color: var(--green);
}

[data-variant='happy'] .badge-recovering {
  background: rgba(196, 163, 90, 0.15);
  color: var(--yellow);
}

[data-variant='happy'] .badge-stabilized {
  background: rgba(123, 165, 196, 0.15);
  color: var(--semantic-info);
}

[data-variant='happy'] .badge-iucn {
  background: rgba(0, 0, 0, 0.06);
  color: var(--text-dim);
}

[data-variant='happy'] .species-region {
  font-size: 11px;
  color: var(--text-dim);
  display: block;
  margin-bottom: 4px;
}

[data-variant='happy'] .species-sparkline {
  padding: 0 8px;
}

[data-variant='happy'] .species-sparkline svg {
  width: 100%;
  display: block;
}

[data-variant='happy'] .species-sparkline text {
  font-size: 9px;
  fill: var(--text-dim);
}

[data-variant='happy'] .species-summary {
  padding: 4px 12px 10px;
}

[data-variant='happy'] .species-summary p {
  font-size: 12px;
  color: var(--text);
  margin: 0 0 4px;
  line-height: 1.4;
}

[data-variant='happy'] .species-source {
  font-size: 10px;
  color: var(--text-dim);
  font-style: normal;
}
```

**Renewable Energy Panel Styles:**

```css
/* === Renewable Energy Panel === */

[data-variant='happy'] .renewable-container {
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

[data-variant='happy'] .renewable-gauge-section {
  display: flex;
  flex-direction: column;
  align-items: center;
}

[data-variant='happy'] .renewable-gauge-section svg {
  max-width: 180px;
  width: 100%;
}

[data-variant='happy'] .gauge-value {
  font-size: 28px;
  font-weight: 700;
  fill: var(--text);
  font-variant-numeric: tabular-nums;
}

[data-variant='happy'] .gauge-label {
  font-size: 12px;
  fill: var(--text-dim);
}

[data-variant='happy'] .gauge-year {
  font-size: 11px;
  color: var(--text-dim);
  text-align: center;
  margin-top: 4px;
}

/* Historical trend sparkline below gauge */
[data-variant='happy'] .renewable-history {
  padding: 0 16px;
}

[data-variant='happy'] .renewable-history svg {
  width: 100%;
  display: block;
}

/* Regional breakdown */
[data-variant='happy'] .renewable-regions {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

[data-variant='happy'] .region-row {
  display: grid;
  grid-template-columns: 140px 1fr 48px;
  align-items: center;
  gap: 8px;
  font-size: 12px;
}

@media (max-width: 768px) {
  [data-variant='happy'] .region-row {
    grid-template-columns: 100px 1fr 40px;
    font-size: 11px;
  }
}

[data-variant='happy'] .region-name {
  color: var(--text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

[data-variant='happy'] .region-bar-container {
  height: 8px;
  background: var(--border);
  border-radius: 4px;
  overflow: hidden;
}

[data-variant='happy'] .region-bar {
  height: 100%;
  border-radius: 4px;
  transition: width 1s ease-out;
}

[data-variant='happy'] .region-value {
  color: var(--text-dim);
  text-align: right;
  font-variant-numeric: tabular-nums;
}
```

**Dark Mode Overrides:**

```css
[data-variant='happy'][data-theme='dark'] .species-card:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

[data-variant='happy'][data-theme='dark'] .badge-iucn {
  background: rgba(255, 255, 255, 0.08);
}
```

All styles must use existing CSS variables (--bg-secondary, --border, --text, --text-dim, --green, --yellow, --semantic-info, --panel-radius, --surface-hover) — NOT hypothetical variables. Match the established pattern from counter-card and positive-card styles.
  </action>
  <verify>
Verify happy-theme.css has new species and renewable sections with `[data-variant='happy']` scoped selectors. Check that all CSS variables referenced actually exist in the theme (--bg-secondary, --border, --text, --text-dim, --green, --yellow, --semantic-info, --panel-radius). Verify dark mode overrides use compound selector pattern.
  </verify>
  <done>
CSS styles render species cards (grid, photo, badges, sparklines) and renewable energy panel (gauge, sparkline, regional bars) attractively in both light and dark modes using existing theme variables.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. App.ts has imports, properties, createPanels, data loading, and destroy for both panels
3. happy.ts DEFAULT_PANELS includes species and renewable entries
4. happy-theme.css has species card grid, photo, badges, sparkline, and renewable gauge/region styles
5. All CSS uses [data-variant='happy'] scoping with dark mode compound selectors
6. All CSS variables are real (not hypothetical)
</verification>

<success_criteria>
- Both panels appear on happy variant dashboard
- Species data loads on startup via fetchConservationWins()
- Renewable data loads on startup via fetchRenewableEnergyData()
- Both panels destroyed cleanly on App shutdown
- CSS styles work in both light and dark modes
- No TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-conservation-energy-trackers/07-03-SUMMARY.md`
</output>
